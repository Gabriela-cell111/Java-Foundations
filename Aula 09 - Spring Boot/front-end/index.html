<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Produtos</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #f5f6f8;
        }
        .card-header {
            background-color: #0d6efd;
            color: #ffffff;
            font-weight: 500;
        }
        pre {
            background-color: #212529;
            color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm">
                <div class="card-header">
                    Cadastro de Produtos
                </div>
                <div class="card-body">

                    <form id="produtoForm">
                        <div class="row g-3">

                            <div class="col-md-6">
                                <label for="tipo" class="form-label">Tipo</label>
                                <select id="tipo" class="form-select" required>
                                    <option value="">Selecione</option>
                                    <option value="Camisa">Camisa</option>
                                    <option value="Blusa">Blusa</option>
                                    <option value="Suéter">Suéter</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="tamanho" class="form-label">Tamanho</label>
                                <select id="tamanho" class="form-select" required>
                                    <option value="">Selecione</option>
                                    <option value="PP">PP</option>
                                    <option value="P">P</option>
                                    <option value="M">M</option>
                                    <option value="G">G</option>
                                    <option value="GG">GG</option>
                                </select>
                            </div>

                            <div class="col-md-6">
                                <label for="quantidade" class="form-label">Quantidade</label>
                                <input type="number" id="quantidade" class="form-control" min="0" step="1" required>
                            </div>

                            <div class="col-md-6">
                                <label for="valor" class="form-label">Valor (R$)</label>
                                <input type="number" id="valor" class="form-control" min="0" step="0.01" required>
                            </div>

                            <div class="col-12">
                                <label for="marca" class="form-label">Marca</label>
                                <input type="text" id="marca" class="form-control" required>
                            </div>

                            <div class="col-12 d-grid">
                                <button type="submit" class="btn btn-primary">Cadastrar Produto</button>
                            </div>
                        </div>
                    </form>

                    <hr class="my-4">

                    <h6>Resposta da API (Cadastro)</h6>
                    <pre id="resultado">Aguardando envio...</pre>

                    <hr class="my-4">

                    <h5 class="mb-3">Produtos Cadastrados</h5>

                    <div class="table-responsive">
                        <table class="table table-striped table-bordered align-middle" id="tabelaProdutos">
                            <thead class="table-dark">
                                <tr>
                                    <th>ID</th>
                                    <th>Tipo</th>
                                    <th>Marca</th>
                                    <th>Tamanho</th>
                                    <th>Quantidade</th>
                                    <th>Preço (R$)</th>
                                    <th>Valor Total (R$)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dados inseridos via JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div id="mensagem" class="mt-3"></div>

                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Bundle JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const form = document.getElementById('produtoForm');
    let resultado = document.getElementById('resultado');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const produto = {
            tipo: document.getElementById('tipo').value,
            tamanho: document.getElementById('tamanho').value,
            quantidade: parseInt(document.getElementById('quantidade').value, 10),
            preco: parseFloat(document.getElementById('valor').value),
            marca: document.getElementById('marca').value
        };

        fetch('http://localhost:8080/roupas', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(produto)
        })
        .then(response => {
                if (response.ok) {
                    resultado.textContent =
                        "Produto cadastrado com sucesso!";
                }
            })
        .catch(error => {
            resultado.textContent = JSON.stringify({ erro: error.message }, null, 2);
        });
    });

    function carregarProdutos() {
        const tbody = document.querySelector('#tabelaProdutos tbody');
        const mensagem = document.getElementById('mensagem');

        tbody.innerHTML = '';
        mensagem.innerHTML = '';

        fetch('http://localhost:8080/roupas')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao consultar produtos');
                }
                return response.json();
            })
            .then(data => {
                if (data.length === 0) {
                    mensagem.innerHTML = '<div class="alert alert-warning">Nenhum produto encontrado</div>';
                    return;
                }

                data.forEach(produto => {
                    const valorTotal = produto.quantidade * produto.preco;

                    const linha = document.createElement('tr');
                    linha.innerHTML = `
                        <td>${produto.id}</td>
                        <td>${produto.tipo}</td>
                        <td>${produto.marca}</td>
                        <td>${produto.tamanho}</td>
                        <td>${produto.quantidade}</td>
                        <td>${produto.preco.toFixed(2)}</td>
                        <td>${valorTotal.toFixed(2)}</td>
                    `;
                    tbody.appendChild(linha);
                });

                mensagem.innerHTML = '<div class="alert alert-success">Produtos carregados com sucesso</div>';
            })
            .catch(error => {
                mensagem.innerHTML = `<div class="alert alert-danger">${error.message}</div>`;
            });
    }

    document.addEventListener('DOMContentLoaded', carregarProdutos);
</script>

</body>
</html>
